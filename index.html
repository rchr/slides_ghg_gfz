<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Richard Redweik &amp; Stefan Lüdtke" />
  <title>CityGML  Applications, Open Data and Open Source Tools</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="reveal.js/css/reveal.css"/>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/night.css" id="theme">
  <!-- If the query includes 'print-pdf', include the PDF print sheet -->
  <script>
    if( window.location.search.match( /print-pdf/gi ) ) {
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = 'reveal.js/css/print/pdf.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
  <style type="text/css">
  		.reveal h1 { font-size: 2.0em; }
  		.reveal h2 { font-size: 1.7em; }
  </style>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">CityGML<br />
 Applications, Open Data and Open Source Tools</h1>
    <h2 class="author">Richard Redweik &amp; Stefan Lüdtke</h2>
    <h3 class="date">22. - 23. November 2015</h3>
</section>

<section id="section" class="level1">
<h1></h1>
<section id="agenda" class="level2">
<h2>Agenda</h2>
<ul>
<li><p>Thursday: General introduction into tools and workflows</p></li>
<li><p>Friday: Practical hands-on session</p></li>
</ul>
</section>
</section>
<section id="section-1" class="level1">
<h1></h1>
<section id="citygml-recap" class="level2">
<h2>CityGML Recap</h2>
<ul>
<li><p>Application independent geospatial information model</p></li>
<li><p>International OGC standard</p></li>
<li><p>Different thematic areas (buildings, water, vegetation, bridges etc.)</p></li>
<li><p>CityGML represents</p>
<ul>
<li>3D geometrey, 3D topology, semantics, and appearance</li>
<li>in 5 discrete scales (levels of detail, LOD)</li>
</ul></li>
<li><p><strong>Data model (UML)</strong> and <strong>exchange format</strong> (based on GML3)</p></li>
</ul>
<p><strong>However!</strong></p>
<p>CityGML datasets may become very large --&gt; Use database to work with!</p>
</section>
</section>
<section id="section-2" class="level1">
<h1></h1>
<section id="need-for-database-some-examples" class="level2">
<h2>Need for Database? Some Examples!</h2>
<ul>
<li><p>Multiple simultaneous changes to data (concurrency)</p></li>
<li><p>Data changes on a regular basis</p></li>
<li><p>Large data sets where you only need some observations/ variables</p></li>
<li><p>Share huge data set among many people (data consistency in a working group!)</p></li>
<li><p>Rapid queries</p></li>
<li><p>Web interfaces to data, especially dynamic data</p></li>
</ul>
</section>
</section>
<section id="section-3" class="level1">
<h1></h1>
<section id="databases" class="level2">
<h2>Databases</h2>
<ul>
<li><p>Data bases are collections of tables (2D with columns and rows)</p></li>
<li><p>Very good for combining information from several tables</p></li>
<li><p>E.g., select all buildings located in Berlin</p></li>
</ul>
<table>
<caption>Table <em>City</em></caption>
<thead>
<tr class="header">
<th style="text-align: left;">ID</th>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Population</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Berlin</td>
<td style="text-align: left;">3502000</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Potsdam</td>
<td style="text-align: left;">159456</td>
</tr>
</tbody>
</table>
<table>
<caption>Table <em>Building</em></caption>
<thead>
<tr class="header">
<th style="text-align: left;">ID</th>
<th style="text-align: left;">City</th>
<th style="text-align: left;">Height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">10.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">22.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">15.0</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="section-4" class="level1">
<h1></h1>
<section id="used-tools" class="level2">
<h2>Used Tools</h2>
<ul>
<li><p>3D City Database (3DCityDB)</p></li>
<li><p>3D City Database Importer/Exporter</p></li>
<li><p>pgAdmin</p></li>
<li><p>QGIS</p></li>
</ul>
</section>
</section>
<section id="section-5" class="level1">
<h1></h1>
<section id="dcitydb---overview" class="level2">
<h2>3DCityDB - Overview</h2>
<figure>
<img src="./pictures/3DCityDB_System.png" alt="Source: Kunde, 2014" /><figcaption>Source: <a href="http://slides.com/fxku/3d-city-database#/">Kunde, 2014</a></figcaption>
</figure>
</section>
</section>
<section id="section-6" class="level1">
<h1></h1>
<section id="dcitydb---details" class="level2">
<h2>3DCityDB - Details</h2>
<p>Free 3D geo database</p>
<p>Enables to store, represent, and manage virtual 3D city models</p>
<p>Realized as relational database schema for:</p>
<ul>
<li><strong>PostgreSQL/PostGIS</strong></li>
<li>Oracle Spatial</li>
</ul>
</section>
</section>
<section id="section-7" class="level1">
<h1></h1>
<section id="dont-be-afraid" class="level2">
<h2>Don't be afraid!</h2>
<ul>
<li><p>May appear complex in the beginning (60 tables)</p></li>
<li><p>But!</p>
<ul>
<li><p>Tables are strucuted logically</p></li>
<li><p>You probably do not use all tables</p></li>
</ul></li>
</ul>
<p>--&gt; 3DCityDB not as complex as it seems!</p>
</section>
</section>
<section id="section-8" class="level1">
<h1></h1>
<section id="dcitydb---building-schema" class="level2">
<h2>3DCityDB - Building Schema</h2>
<p>Subset of the building schema</p>
<figure>
<img src="./pictures/building_schema_small.png" alt="Source: 3DCityDB v3.0.0 Documentation" /><figcaption>Source: 3DCityDB v3.0.0 Documentation</figcaption>
</figure>
</section>
</section>
<section id="section-9" class="level1">
<h1></h1>
<section id="postgresql" class="level2">
<h2>PostgreSQL</h2>
<ul>
<li><p>Relational Database Management System (RDBMS)</p></li>
<li><p><strong>Open Source</strong></p></li>
<li><p>Strong reputation for <strong>reliability</strong>, <strong>data integrity</strong> and <strong>correctness</strong></p></li>
<li><p>Very good documentation</p></li>
<li><p>Runs on Linux, Unix (MacOS, BSD), Windows</p></li>
<li><p>pgAdmin as GUI for administration</p></li>
</ul>
</section>
</section>
<section id="section-10" class="level1">
<h1></h1>
<section id="sql" class="level2">
<h2>SQL</h2>
<ul>
<li><strong>S</strong>tructured <strong>Q</strong>uery <strong>L</strong>anguage</li>
<li>Language to save, edit and query data in relational data bases</li>
<li>First version in 1974 (IBM)</li>
<li>Became a standard of the American National Standards Institute (ANSI) in 1986</li>
<li>Revised in 1999: SQL99 or SQL3</li>
<li>SQL has standards but also some pecularities depending on the database management system</li>
<li>Used to 'talk' to the database server</li>
<li>Used as front end for postgresql</li>
<li>Case sensitive (usually upper case for keywords)</li>
</ul>
</section>
</section>
<section id="section-11" class="level1">
<h1></h1>
<section id="ways-to-use-sql" class="level2">
<h2>Ways to use SQL</h2>
<ul>
<li><p>Console command (psql -h hostaddress -U db_name)</p></li>
<li><p>GUI (pgadmin)</p></li>
<li><p>Interfaces to programming languages (R, python, Java, etc.)</p></li>
</ul>
</section>
</section>
<section id="section-12" class="level1">
<h1></h1>
<section id="sql-syntax---i" class="level2">
<h2>SQL Syntax - I</h2>
<ul>
<li><p>Create Database</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">TABLE</span> measurements (<span class="kw">id</span> BIGINT <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span>, <span class="dt">date</span> <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span>, <span class="fu">value</span> <span class="dt">DOUBLE</span> <span class="dt">PRECISION</span>);</code></pre></div></li>
<li><p>Insert Data</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">INSERT</span> <span class="kw">INTO</span> mesurements 
<span class="kw">VALUES</span>(<span class="st">&#39;2014-09-01&#39;</span>, <span class="fl">10.456</span>);</code></pre></div></li>
<li><p>Edit Data</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">UPDATE</span> measurements 
<span class="kw">SET</span> <span class="fu">value</span> = <span class="fu">value</span> + <span class="dv">1</span>;</code></pre></div></li>
</ul>
</section>
</section>
<section id="section-13" class="level1">
<h1></h1>
<section id="sql-syntax---ii" class="level2">
<h2>SQL syntax - II</h2>
<ul>
<li><p>Query Data</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> <span class="fu">value</span> 
<span class="kw">FROM</span> measurements;</code></pre></div></li>
<li><p>Comparison/Filter</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> <span class="fu">value</span> 
<span class="kw">FROM</span> measurements 
<span class="kw">WHERE</span> <span class="dt">date</span> &gt; <span class="st">&#39;2013-01-01&#39;</span>;</code></pre></div></li>
<li><p>Summary and Computations</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> <span class="fu">MAX</span>(<span class="fu">value</span>) <span class="kw">AS</span> max_val 
<span class="kw">FROM</span> measurements 
<span class="kw">WHERE</span> <span class="dt">date</span> &gt; <span class="st">&#39;2013-01-01&#39;</span></code></pre></div></li>
</ul>
</section>
<section id="postgresql-1" class="level2">
<h2>PostgreSQL</h2>
<figure>
<img src="./pictures/icon_postgresql.png" alt="" />
</figure>
<ul>
<li><p>Includes most SQL:2008 data types, including INTEGER, NUMERIC, BOOLEAN, CHAR, VARCHAR, DATE, INTERVAL, and TIMESTAMP</p></li>
<li><p>Supports storage of binary large objects, including pictures, sounds, or video</p></li>
<li><p>Diverse native programming interfaces (C/C++, Java, .Net, Perl, Python, ... )</p></li>
</ul>
</section>
<section id="key-features" class="level2">
<h2>Key features</h2>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Limit</th>
<th style="text-align: center;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Database Size</td>
<td style="text-align: center;">Unlimited</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maximum Table Size</td>
<td style="text-align: center;">32 TB</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum Row Size</td>
<td style="text-align: center;">1.6 TB</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maximum Field Size</td>
<td style="text-align: center;">1 GB</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum Rows per Table</td>
<td style="text-align: center;">Unlimited</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maximum Columns per Table</td>
<td style="text-align: center;">250 - 1600 depending on column types</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Maximum Indexes per Table</td>
<td style="text-align: center;">Unlimited</td>
</tr>
</tbody>
</table>
</section>
<section id="architecture" class="level2">
<h2>Architecture</h2>
<figure>
<img src="./pictures/client_server.png" alt="client server" /><figcaption>client server</figcaption>
</figure>
</section>
<section id="sql-1" class="level2">
<h2>SQL</h2>
<ul>
<li><strong>S</strong>tructured <strong>Q</strong>uery <strong>L</strong>anguage</li>
<li>Language to save, edit and query data in relational data bases</li>
<li>First version in 1974 (IBM)</li>
<li>Became a standard of the American National Standards Institute (ANSI) in 1986</li>
<li>Revised in 1999: SQL99 or SQL3</li>
<li>SQL has standards but also some pecularities depending on the database management system</li>
<li>Used to 'talk' to the database server</li>
<li>Used as front end for postgresql</li>
<li>Case sensitive (usually upper case for keywords)</li>
</ul>
</section>
<section id="ways-to-use-sql-1" class="level2">
<h2>Ways to use SQL</h2>
<ul>
<li><p>Console command (psql -h hostaddress -U db_name)</p></li>
<li><p>GUI (pgadmin)</p></li>
<li><p>Interfaces to programming languages (R, python, Java, etc.)</p></li>
</ul>
</section>
<section id="sql-syntax---i-1" class="level2">
<h2>SQL Syntax - I</h2>
<ul>
<li><p>Create Database</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">TABLE</span> measurements (<span class="kw">id</span> BIGINT <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="kw">DEFAULT</span>, <span class="dt">date</span> <span class="dt">TIMESTAMP</span> <span class="kw">WITH</span> <span class="dt">TIME</span> <span class="dt">ZONE</span>, <span class="fu">value</span> <span class="dt">DOUBLE</span> <span class="dt">PRECISION</span>);</code></pre></div></li>
<li><p>Insert Data</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">INSERT</span> <span class="kw">INTO</span> mesurements 
<span class="kw">VALUES</span>(<span class="st">&#39;2014-09-01&#39;</span>, <span class="fl">10.456</span>);</code></pre></div></li>
<li><p>Edit Data</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">UPDATE</span> measurements 
<span class="kw">SET</span> <span class="fu">value</span> = <span class="fu">value</span> + <span class="dv">1</span>;</code></pre></div></li>
</ul>
</section>
<section id="sql-syntax---ii-1" class="level2">
<h2>SQL syntax - II</h2>
<ul>
<li><p>Query Data</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> <span class="fu">value</span> 
<span class="kw">FROM</span> measurements;</code></pre></div></li>
<li><p>Comparison/Filter</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> <span class="fu">value</span> 
<span class="kw">FROM</span> measurements 
<span class="kw">WHERE</span> <span class="dt">date</span> &gt; <span class="st">&#39;2013-01-01&#39;</span>;</code></pre></div></li>
<li><p>Summary and Computations</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> <span class="fu">MAX</span>(<span class="fu">value</span>) <span class="kw">AS</span> max_val 
<span class="kw">FROM</span> measurements 
<span class="kw">WHERE</span> <span class="dt">date</span> &gt; <span class="st">&#39;2013-01-01&#39;</span></code></pre></div></li>
</ul>
</section>
</section>
<section id="section-14" class="level1">
<h1></h1>
<section id="postgis" class="level2">
<h2>PostGIS</h2>
<ul>
<li><p>Spatial extension for PostgreSQL</p></li>
<li><p>Support for spatial objects (geometry, geography, raster)</p></li>
<li><p>Spatial predicates (interaction of geometries)</p></li>
<li>Spatial operators
<ul>
<li>Measurements (area, distance, length, etc.)</li>
<li>Set operations (union, difference, etc.)</li>
</ul></li>
<li><p>Multi-dimensional spatial indexing</p></li>
</ul>
</section>
</section>
<section id="section-15" class="level1">
<h1></h1>
<section id="postgis---example" class="level2">
<h2>PostGIS - Example</h2>
<ul>
<li><p>Select cities with certain area and population</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> name, pop <span class="kw">FROM</span> cities 
<span class="kw">WHERE</span> pop &lt; <span class="dv">300000</span>  
<span class="kw">AND</span> ST_Area(cities.the_geom) &lt; <span class="dv">400000000</span>;</code></pre></div></li>
<li><p>Select houses located in the suburbs</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> houses.*
<span class="kw">FROM</span> houses, suburbs
<span class="kw">WHERE</span> ST_Intersects(houses.geom, suburbs.geom);</code></pre></div></li>
</ul>
</section>
<section id="additional-data-type-for-geometry" class="level2">
<h2>Additional Data Type for Geometry</h2>
<ul>
<li><p>The geometry is stored in a extra column, usually termed <em>geom</em> or <em>the_geom</em>, all based the following <a href="http://postgis.net/docs/manual-2.1/using_postgis_dbmanagement.html">link</a></p></li>
<li><p>Uses Well-Known Binary (WKB) and Well-Known Text (WKT) Representations defined by <em>OGC</em></p></li>
<li>Example WKB:
<ul>
<li>POINT (10 10)</li>
<li>LINESTRING (10 10,20 20,30 40)</li>
<li>POLYGON ((10 10, 10 20, 20 20, 20 15, 10 10))</li>
<li>MULTIPOINT ((0 0),(1 2))</li>
<li>MULTILINESTRING ((0 0,1 1,1 2),(2 3,3 2,5 4))</li>
</ul></li>
</ul>
</section>
<section id="postgis-provides" class="level2">
<h2>PostGIS provides</h2>
<ul>
<li><p>Processing and analytic functions for both vector and raster data (e.g. splicing, dicing, morphing, reclassifying, and unioning)</p></li>
<li><p>Raster map algebra</p></li>
<li><p>Functions for spatial reprojection</p></li>
<li><p>Support for ESRI shapefile vector data (+ more formats via 3rd-party tools)</p></li>
<li>Importing data from many standard formats
<ul>
<li>Raster data (GeoTiff, NetCDF, PNG, JPG, ...)</li>
<li>Vector data (KML,GML, GeoJSON, GeoHash and WKT)</li>
</ul></li>
</ul>
</section>
<section id="postgis-provides-cont." class="level2">
<h2>PostGIS provides (cont.)</h2>
<ul>
<li><p>Rendering raster data in various standard formats GeoTIFF, PNG, JPG, NetCDF, ...</p></li>
<li><p>Seamless raster/vector functions for extrusion of pixel values by geometric region, running stats by region, clipping rasters by a geometry, and vectorizing rasters</p></li>
<li><p>3D object support, spatial index, and functions</p></li>
<li><p>Network topology</p></li>
</ul>
</section>
<section id="postgis-as-a-gis" class="level2">
<h2>PostGIS as a GIS</h2>
<ul>
<li><strong>PostGIS offers <em>full</em> GIS functionality ...</strong>
<ul>
<li>reprojection</li>
<li>area calculations</li>
<li>intersect, union, merge ...</li>
</ul></li>
<li><strong>... among all data-types</strong>
<ul>
<li>all vector types supported (point, line, area ...)</li>
<li>raster layers supported as well</li>
</ul></li>
<li><strong>and standard interfaces for visualization</strong>
<ul>
<li>QGIS, GRASS spatial layers from a Postgres DB out of the box</li>
<li>ArcMap is supposed to do so as well</li>
</ul></li>
</ul>
</section>
<section id="postgis-functions" class="level2">
<h2>PostGIS Functions</h2>
<ul>
<li>'<code>ST_</code>' prefix (Convention for spatial type)</li>
<li><p>Functions to work with the <em>geom</em> column</p></li>
<li><p>Getting the CRS of the table/layer</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> ST_SRID(geom)
<span class="kw">FROM</span> catchments;</code></pre></div></li>
<li><p>Re-project geometry into a different CRS</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">UPDATE</span> subbasins 
<span class="kw">SET</span> geom = ST_TRANSFORM(geom, <span class="dv">4326</span>);</code></pre></div></li>
</ul>
</section>
<section id="postgis---example-1" class="level2">
<h2>PostGIS - Example</h2>
<ul>
<li><p>Select cities with certain area and population</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> name, pop <span class="kw">FROM</span> cities 
<span class="kw">WHERE</span> pop &lt; <span class="dv">300000</span>  
<span class="kw">AND</span> ST_Area(cities.the_geom) &lt; <span class="dv">400000000</span>;</code></pre></div></li>
<li><p>Select houses located in the suburbs</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> houses.*
<span class="kw">FROM</span> houses, suburbs
<span class="kw">WHERE</span> ST_Intersects(houses.geom, suburbs.geom);</code></pre></div></li>
</ul>
</section>
</section>
<section id="section-16" class="level1">
<h1></h1>
<section id="d-city-database-importerexporter" class="level2">
<h2>3D City Database Importer/Exporter</h2>
<p>Front-end for 3D city database</p>
<p>Allows importing and exporting of CityGML data into/from 3DCityDB</p>
<p>Allows export in KML and COLLADA for visualization</p>
<p>Offers GUI and CLI</p>
</section>
</section>
<section id="section-17" class="level1">
<h1></h1>
<section id="dcitydb-overview" class="level2">
<h2>3DCityDB-Overview</h2>
<figure>
<img src="./pictures/3DCityDB_System.png" alt="Source: Kunde, 2014" /><figcaption>Source: <a href="http://slides.com/fxku/3d-city-database#/">Kunde, 2014</a></figcaption>
</figure>
</section>
</section>
<section id="section-18" class="level1">
<h1></h1>
<section id="qgis" class="level2">
<h2>QGIS</h2>
<p>Previously known as <em>Quantum GIS</em></p>
<p>Open source Geographic Information System (GIS)</p>
<p>Integration of <strong>PostGIS</strong> and GRASS</p>
<p>Runs on Linux, Unix, MacOS, Windows, Android</p>
<p>Supports many vector, raster, and database formats and functionalities</p>
<p>Customizable via plugins (C++, Python)</p>
</section>
</section>
<section id="section-19" class="level1">
<h1></h1>
<section id="d-city-model-berlin" class="level2">
<h2>3D City Model Berlin</h2>
<p>550.000 buildings on about 890 sqkm</p>
<p>LOD2 building models with facade textures</p>
<p>Can be downloaded and used as part of Berlin's Open Data Initiative</p>
<p>Berlin 3D - <a href="http://www.businesslocationcenter.de/en/downloadportal">Download Portal</a></p>
</section>
</section>
<section id="section-20" class="level1">
<h1></h1>
<section id="data-modelling" class="level2">
<h2>Data modelling</h2>
<p>is <strong>fundamental</strong> for efficient</p>
<ul>
<li>storage of data</li>
<li>data maintenance</li>
<li>work with data</li>
</ul>
</section>
<section id="database-normalisation" class="level2">
<h2>Database normalisation</h2>
<p>Normalisation is the formalisation of the design process of making a database compliant with the concept of a Normal Form.</p>
<p>It addresses various ways in which we may look for repeating data values in a table.</p>
<p>There are several levels of the Normal Form, and each level requires that the previous level be satisfied.</p>
<p>The normalization process is based on collecting an exhaustive list of all data items to be maintained in the database and starting the design with a few &quot;superset&quot; tables.</p>
</section>
<section id="normalisation--first-normal-form" class="level2">
<h2>Normalisation- First Normal Form</h2>
<p>For best results, start with a reasonable breakdown of all attributes in different tables</p>
<p>Reduce entities to first normal form (1NF) by removing repeating or multivalued attributes to another, child entity.</p>
<p>Basically, make sure that the data is represented as a (proper) table.</p>
<p>While key to the relational principles, this is somewhat a motherhood statement.</p>
</section>
<section id="normalisation--first-normal-form-1" class="level2">
<h2>Normalisation- First Normal Form</h2>
<p>However, there are six properties of a relational table (the formal name for &quot;table&quot; is &quot;relation&quot;):</p>
<ol type="1">
<li>Entries in columns are single-valued.</li>
<li>Entries in columns are of the same kind.</li>
<li>Each row is unique.</li>
<li>Sequence of columns is insignificant.</li>
<li>Sequence of rows is insignificant.</li>
<li>Each column has a unique name.</li>
</ol>
<p><br />
 The most common sins against the first normal form (1NF) are the lack of a Primary Key and the use of &quot;repeating columns.&quot;</p>
</section>
<section id="normalisation--second-normal-form" class="level2">
<h2>Normalisation- Second Normal Form</h2>
<p>Reduce first normal form entities to second normal form (2NF) by removing attributes that are not dependent on the whole primary key.</p>
<p>The purpose here is to make sure that each column is defined in the correct table. Using the more formal names may make this a little clearer. Make sure each attribute is kept with the entity that it describes.</p>
</section>
<section id="normalisation--third-normal-form" class="level2">
<h2>Normalisation- Third Normal Form</h2>
<p>Reduce second normal form entities to third normal form (3NF) by removing attributes that depend on other, non-key attributes (other than alternative keys).</p>
<p>This basically means that we shouldn't store any data that can either be derived from other columns or belong in another table</p>
<p><br />
<br />
 * for more background and guidance <a href="http://www.codeguru.com/csharp/.net/net_data/article.php/c19615/Introduction-to-Relational-Databases--Part-1-Theoretical-Foundation.htm">code guru</a></p>
</section>
</section>
<section id="section-21" class="level1">
<h1></h1>
<section id="hands-on" class="level2">
<h2>Hands-On</h2>
<p>Create Database</p>
<p>Create 3D City Database</p>
<p>Import City Model</p>
<p>Inspect Database with pgAdmin</p>
<p>Export building data with QGIS</p>
</section>
</section>
<section id="section-22" class="level1">
<h1></h1>
<section id="thursday" class="level2">
<h2>Thursday!</h2>
</section>
</section>
<section id="section-23" class="level1">
<h1></h1>
<section id="export-building-data-with-qgis---i" class="level2">
<h2>Export building data with QGIS - I</h2>
<p>Query:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">WITH</span>
groundSurfaces <span class="kw">AS</span> (
    <span class="kw">SELECT</span> thematic_surface.* 
    <span class="kw">FROM</span> citydb.thematic_surface <span class="kw">INNER</span> <span class="kw">JOIN</span> citydb.objectclass 
    <span class="kw">ON</span> objectclass.id = thematic_surface.objectclass_id 
    <span class="kw">WHERE</span> classname=<span class="st">&#39;BuildingGroundSurface&#39;</span>
),
surfaceGeometries <span class="kw">AS</span> (
    <span class="kw">SELECT</span> *
    <span class="kw">FROM</span> citydb.surface_geometry <span class="kw">INNER</span> <span class="kw">JOIN</span> groundSurfaces
    <span class="kw">ON</span> groundSurfaces.lod2_multi_surface_id = surface_geometry.parent_id
    <span class="kw">WHERE</span> geometry <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span>
),
heights <span class="kw">AS</span> (
    <span class="kw">SELECT</span> measured_height, surfaceGeometries.*
    <span class="kw">FROM</span> citydb.building <span class="kw">INNER</span> <span class="kw">JOIN</span> surfaceGeometries
    <span class="kw">ON</span> building.id = surfaceGeometries.building_id
)
<span class="kw">SELECT</span> <span class="fu">row_number</span>() <span class="kw">OVER</span>() <span class="kw">As</span> <span class="kw">id</span>, building_id, 
measured_height, ST_Force2d(geometry) <span class="kw">AS</span> footprint <span class="kw">FROM</span> heights;</code></pre></div>
</section>
</section>
<section id="section-24" class="level1">
<h1></h1>
<section id="export-building-data-with-qgis---ii" class="level2">
<h2>Export building data with QGIS - II</h2>
<figure>
<img src="./pictures/qgis_db3.png" alt="" />
</figure>
</section>
</section>
<section id="section-25" class="level1">
<h1></h1>
<section id="export-building-data-with-qgis---iii" class="level2">
<h2>Export building data with QGIS - III</h2>
<figure>
<img src="./pictures/qgis_db4.png" alt="" />
</figure>
</section>
</section>
<section id="section-26" class="level1">
<h1></h1>
<section id="eddy-footprint-with-3d-city-model" class="level2">
<h2>Eddy Footprint with 3D City Model</h2>
<p>Footprint provided by Gerardo Fratini!</p>
</section>
</section>
<section id="section-27" class="level1">
<h1></h1>
<section id="outlook-local" class="level2">
<h2>Outlook LoCaL</h2>
<p>Low Carbon City Lab</p>
<figure>
<img src="./pictures/local_small.png" alt="" />
</figure>
</section>
</section>
<section id="section-28" class="level1">
<h1></h1>
<section id="outlook-local-1" class="level2">
<h2>Outlook LoCaL</h2>
<p>Architecture <img src="./pictures/local_arch.png" alt="" /></p>
</section>
</section>
<section id="section-29" class="level1">
<h1></h1>
<section id="outlook-local-2" class="level2">
<h2>Outlook LoCaL</h2>
<p>Information View <img src="./pictures/local_building.png" alt="" /></p>
</section>
</section>
<section id="section-30" class="level1">
<h1></h1>
<section id="questions" class="level2">
<h2>Questions?</h2>
<p>Focus for tomorrow?</p>
</section>
</section>
<section id="section-31" class="level1">
<h1></h1>
<section id="friday" class="level2">
<h2>Friday!</h2>
</section>
</section>
<section id="section-32" class="level1">
<h1></h1>
<section id="create-database" class="level2">
<h2>Create Database</h2>
<p>Execute following statement as PostgreSQL admin:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">DATABASE</span> ghg_handson
<span class="kw">WITH</span> OWNER = ghg;</code></pre></div>
<p>... and to enable PostGIS:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> EXTENSION postgis;</code></pre></div>
<p>It is already done on the VM! \o/</p>
</section>
</section>
<section id="section-33" class="level1">
<h1></h1>
<section id="create-3d-city-database-3dcitydb" class="level2">
<h2>Create 3D City Database (3DCityDB)</h2>
<p>The 3DCityDB is a relational database schema</p>
<p>Schema results from a mapping of the object-oriented data model of CityGML to the relational data model of the RDBMS</p>
<p>Schema is like a 'blueprint' of the database</p>
<p>To create the schema with its tables execute:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">cd</span> /home/ghg/Documents/3DCityDB-3.0.0-postgis/PostgreSQL/SQLScripts/
<span class="kw">psql</span> ghg_handson -f CREATE_DB.sql</code></pre></div>
</section>
<section id="section-34" class="level2">
<h2></h2>
<p>Setup requires user input:</p>
<ol type="1">
<li>Spatial Reference Identifier for geometry objects (SRID):</li>
</ol>
<p><strong>25833</strong></p>
<ol start="2" type="1">
<li>GML conformant URN encoding for gml:srsName attributes:</li>
</ol>
<p><strong>urn:ogc:def:crs,crs:EPSG::25833,crs:EPSG::5783</strong></p>
</section>
</section>
<section id="section-35" class="level1">
<h1></h1>
<section id="import-city-model" class="level2">
<h2>Import City Model</h2>
<p>Start 3D City Database Importer/Exporter</p>
</section>
<section id="connect-to-database" class="level2">
<h2>Connect to Database</h2>
<figure>
<img src="./pictures/impexp_database.png" alt="" />
</figure>
</section>
<section id="do-the-import" class="level2">
<h2>Do the import</h2>
<figure>
<img src="./pictures/impexp_import.png" alt="" />
</figure>
</section>
</section>
<section id="section-36" class="level1">
<h1></h1>
<section id="play-around-with-pgadmin" class="level2">
<h2>Play around with pgAdmin</h2>
<p>pgAdmin provides an interface/gui to:</p>
<ol type="1">
<li>Administration of the DB
<ul>
<li>Server administration and configuration (pg_hba.conf, postgresql.conf)</li>
<li>user and group management</li>
<li>setup privileges (permissions what user can do and can <strong>not</strong> do</li>
</ul></li>
<li>Query the DB
<ul>
<li>Graphical query builder</li>
<li><em>sql</em> window</li>
</ul></li>
</ol>
</section>
<section id="query-the-db" class="level2">
<h2>Query the DB</h2>
<p><strong>Ask for all building greater than height X</strong></p>
<p>Open the <em>sql</em>-query window</p>
<figure>
<img src="./pictures/pgadmin_query_sql_window.png" alt="" />
</figure>
</section>
<section id="graphical-query-builder" class="level2">
<h2>Graphical query builder</h2>
<ul>
<li><p>Similar to DB connectors shipped with common Office suites (e.g. MS <em>the evil</em> Office and Libre<em>the brave</em> Office)</p></li>
<li>allows drag and drop of required tables</li>
<li>click selection of required columns</li>
<li><p>interface to restrict table attributes</p></li>
</ul>
</section>
<section id="graphical-query-builder-1" class="level2">
<h2>Graphical query builder</h2>
<figure>
<img src="./pictures/graphic_query.png" alt="" />
</figure>
</section>
<section id="sql-editor-window" class="level2">
<h2>Sql editor window</h2>
<ul>
<li>is updated based on the graphical query builder</li>
<li>can send parts of sql query (sub-queries)</li>
</ul>
<figure>
<img src="./pictures/pgadmin_query.png" alt="" />
</figure>
</section>
</section>
<section id="section-37" class="level1">
<h1></h1>
<section id="export-data-with-qgis" class="level2">
<h2>Export data with QGIS</h2>
</section>
<section id="start-qgis" class="level2">
<h2>Start QGIS</h2>
<ol type="1">
<li><p>Open QGIS Desktop</p></li>
<li><p>Add new database:</p>
<ol type="1">
<li><p>Click on the PostGIS logo (Elephant)</p></li>
<li><p>Select 'New'</p></li>
</ol></li>
</ol>
</section>
<section id="add-new-database" class="level2">
<h2>Add New Database</h2>
<figure>
<img src="./pictures/qgis_database.png" alt="" />
</figure>
</section>
<section id="connect-to-database-1" class="level2">
<h2>Connect to Database</h2>
<figure>
<img src="./pictures/qgis_db_7.png" alt="" />
</figure>
</section>
<section id="query-buildings-from-db" class="level2">
<h2>Query Buildings from DB</h2>
<p>Open 'Database' &gt; 'DB Manager' &gt; 'DB Manager'</p>
<p>Select database 'ghg_handson' and open 'SQL window'</p>
<figure>
<img src="./pictures/qgis_db2.png" alt="" />
</figure>
</section>
<section id="query-buildings-from-db-cont." class="level2">
<h2>Query Buildings from DB (cont.)</h2>
<p>Execute following query:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">WITH</span>
groundSurfaces <span class="kw">AS</span> (
    <span class="kw">SELECT</span> thematic_surface.* 
    <span class="kw">FROM</span> citydb.thematic_surface <span class="kw">INNER</span> <span class="kw">JOIN</span> citydb.objectclass 
    <span class="kw">ON</span> objectclass.id = thematic_surface.objectclass_id 
    <span class="kw">WHERE</span> classname=<span class="st">&#39;BuildingGroundSurface&#39;</span>
),
surfaceGeometries <span class="kw">AS</span> (
    <span class="kw">SELECT</span> *
    <span class="kw">FROM</span> citydb.surface_geometry <span class="kw">INNER</span> <span class="kw">JOIN</span> groundSurfaces
    <span class="kw">ON</span> groundSurfaces.lod2_multi_surface_id = surface_geometry.parent_id
    <span class="kw">WHERE</span> geometry <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span>
),
heights <span class="kw">AS</span> (
    <span class="kw">SELECT</span> measured_height, surfaceGeometries.*
    <span class="kw">FROM</span> citydb.building <span class="kw">INNER</span> <span class="kw">JOIN</span> surfaceGeometries
    <span class="kw">ON</span> building.id = surfaceGeometries.building_id
)
<span class="kw">SELECT</span> <span class="fu">row_number</span>() <span class="kw">OVER</span>() <span class="kw">As</span> <span class="kw">id</span>, building_id, 
measured_height, ST_Force2d(geometry) <span class="kw">AS</span> footprint <span class="kw">FROM</span> heights;</code></pre></div>
<p>Query stored in file:</p>
<p><em>/home/ghg/Desktop/ghg_flux_ws/city_gml/hands-on/select_footprint_height.sql</em></p>
</section>
<section id="query-buildings-from-db-cont.-1" class="level2">
<h2>Query Buildings from DB (cont.)</h2>
<p>Select 'Load as new layer'</p>
<p>'Column with unique integer values' : 'id'</p>
<p>'Geometry column' : 'footprint'</p>
</section>
<section id="query-buildings-from-db-cont.-2" class="level2">
<h2>Query Buildings from DB (cont.)</h2>
<figure>
<img src="./pictures/qgis_db3.png" alt="" />
</figure>
</section>
<section id="buildings-with-attributes" class="level2">
<h2>Buildings with Attributes</h2>
<figure>
<img src="./pictures/qgis_db4.png" alt="" />
</figure>
</section>
<section id="buildings-with-attributes-1" class="level2">
<h2>Buildings with Attributes</h2>
<p>Example building:</p>
<figure>
<img src="./pictures/qgis_building_attribs.png" alt="" />
</figure>
</section>
<section id="export-to-shape-i" class="level2">
<h2>Export to Shape I</h2>
<p>Do a right-click onto the layer:</p>
<figure>
<img src="./pictures/qgis_save_as.png" alt="" />
</figure>
</section>
<section id="export-to-shape-ii" class="level2">
<h2>Export to Shape II</h2>
<figure>
<img src="./pictures/qgis_db6.png" alt="" />
</figure>
</section>
</section>
    </div>
  </div>


  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,         // Display controls in the bottom right corner
        progress: true,         // Display a presentation progress bar
        history: true,          // Push each slide change to the browser history
        center: true,                       // Vertical centering of slides
        maxScale: 1.5,                  // Bounds for smallest/largest possible content scale
        slideNumber: false,                // Display the page number of the current slide
        theme: 'night', // available themes are in /css/theme
        transition: 'fade', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
//          { src: 'reveal.js/plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; }, }
//          { src: 'reveal.js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
]});
    </script>
    </body>
</html>
